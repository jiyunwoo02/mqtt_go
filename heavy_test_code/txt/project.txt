<프로젝트 구상도: MQTT 브로커 & 클라이언트 기능 테스트 및 메시지 발행 시스템>

1. 목표

이 프로젝트는 MQTT의 기본 기능 테스트를 넘어, 다수의 구독자가 동일한 주제를 구독할 때의 성능과 메시지 일관성을 확인하는 것이 목적이다.

- MQTT 브로커와 클라이언트의 기본 기능 테스트를 완료하고, heavy load 테스트를 준비한다.
- 하나의 프로그램 내에서 여러 구독자가 동일한 주제를 구독하고, 메시지 수신 상태를 검증한다.
- 발행자가 발행한 메시지를 구독자에게 브로커를 거치지 않고 직접 알리는 소켓 통신을 구현한다.
- 사용자로부터 메시지 발행 횟수와 구독자 수를 입력받아 테스트의 유연성을 제공한다.

2. 프로젝트 구조

[1] 발행자 (Publisher)
기능:
- 사용자로부터 QoS 값(0, 1, 2)을 명령행 플래그로 입력받아 설정. (-o 플래그 사용)
- 사용자가 발행할 메시지와 발행 횟수(n)를 입력하면, 해당 메시지를 n번 반복 발행.
(예: "hello#1", "hello#2" ... "hello#n")
- 메시지 발행과 동시에 구독자에게 발행 메시지를 직접 알리기 위한 소켓 통신 채널을 열어 메시지를 전달.

[2] 구독자 (Subscriber)
기능:
- 동일한 주제를 여러 구독자가 동시에 구독하는 환경을 테스트.
- 사용자로부터 구독자 수(sn)를 입력받아, 동일한 프로그램 내에서 sn개의 구독자를 생성.
- 각 구독자는 주제에 대해 메시지를 수신하고, 수신한 메시지의 개수를 검증.
- 기대되는 메시지의 개수와 실제로 수신된 메시지의 개수를 비교해 출력.

[3] 시스템 상태 모니터링 및 출력
출력 형식 구상:
- 구독자의 수(sn)와 각 구독자가 수신한 메시지의 개수를 표 형태로 출력
(출력 결과)
--------------------------------------------------
구독자 번호   | 수신한 메시지 개수  | 기대 메시지 개수
--------------------------------------------------
Subscriber 1 | 5                 | 5
--------------------------------------------------
Subscriber 2 | 5                 | 5
--------------------------------------------------
...          |                   |
--------------------------------------------------
Subscriber n | 5                 | 5
--------------------------------------------------

- 모든 구독자의 수신 상태가 완료되면 종합 결과를 요약 출력
(출력 결과)
총 구독자 수: 100
성공적으로 수신된 메시지: 1000 / 1000 (100%)

[4] 발행자와 구독자 간의 소켓 통신
- 발행자는 브로커를 거치지 않고 직접 구독자에게 발행 메시지를 알리기 위해 TCP 소켓 통신을 사용.
- 발행자가 메시지를 발행할 때마다 구독자에게 발행 메시지를 직접 전달.
- 구독자는 소켓을 통해 수신된 메시지를 로깅하여 발행자 메시지와의 일관성을 확인.

3. 프로젝트 순서도

(1) 초기 설정:
- MQTT 브로커를 실행.
- QoS 수준과 구독자 수, 메시지 발행 횟수(n)를 사용자로부터 입력받음.

(2) 발행자 (Publisher):
- 명령행 플래그(-o)를 통해 QoS 설정.
- 발행할 메시지와 n값을 사용자로부터 입력받아, n번 반복 발행.
- TCP 소켓을 통해 구독자에게 직접 메시지를 전달.

(3) 구독자 (Subscriber):
- 사용자 입력(sn)을 기반으로 sn명의 구독자를 동일한 주제에 연결.
- 각 구독자가 메시지를 수신하고, 수신된 메시지의 개수를 기록.

(4) 메시지 수신 검증:
- 기대되는 메시지 개수와 실제 수신된 개수를 비교.
- 구독자별로 수신 현황을 표로 출력.

(5) 결과 요약 및 종료:
- 모든 메시지 수신이 완료되면 총 메시지 수신 상태를 요약.
- 프로그램 종료.

4. 프로젝트 구성도

사용자 입력  ➔  발행자 ➔  MQTT 브로커 ➔  여러 구독자
                      │
                      └──> 구독자에게 직접 발행 메시지 전달 (소켓 통신)

5. 예상 출력 예시

<1> 발행자의 메시지 발행:
Enter the message to publish: Hello!
Enter the number of times to publish: 5
Publishing messages: Hello#1, Hello#2, Hello#3, Hello#4, Hello#5

Published: Hello#1
Published: Hello#2
...
Published: Hello#5

<2> 구독자 상태:
Subscriber 1 received: Hello#1
Subscriber 1 received: Hello#2
...
Subscriber 1: Received 5/5 messages
Subscriber 2: Received 5/5 messages
...

All subscribers completed. 
- Topic: test/topic | Expected messages for each subscribers: 5

--------------------------------------------------
구독자 번호   | 수신한 메시지 개수  | 기대 메시지 개수
--------------------------------------------------
Subscriber 1 | 5                 | 5
--------------------------------------------------
Subscriber 2 | 5                 | 5
--------------------------------------------------
...          |                   |
--------------------------------------------------
Subscriber n | 5                 | 5
--------------------------------------------------

총 구독자 수: 100
성공적으로 수신된 메시지: 500 / 500 (100%)

<3> 소켓 통신 메시지 확인:
[소켓 통신] 발행자가 보낸 메시지: Hello#1
[소켓 통신] 발행자가 보낸 메시지: Hello#2
...